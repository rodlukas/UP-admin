<p align="center">
    <img src="./admin/static/admin/android-chrome-192x192.png" alt="√öPadmin logo" width="72">
</p>

<h3 align="center">√öPadmin</h1>

<p align="center">
    Webov√° aplikace pro projekt <strong><a href="https://uspesnyprvnacek.cz/">√öspƒõ≈°n√Ω prv≈à√°ƒçek</a></strong>.
</p>

<p align="center">
    Read this in other languages: <strong><a href="README.md">English</a></strong>, <strong><a href="README.cs.md">Czech</a></strong>.
</p>

<p align="center">
    <a href="https://github.com/rodlukas/UP-admin/actions/workflows/test.yml"><img alt="GitHub Actions" src="https://github.com/rodlukas/UP-admin/actions/workflows/test.yml/badge.svg"></a>
    <a href="https://codecov.io/gh/rodlukas/UP-admin"><img alt="Codecov" src="https://img.shields.io/codecov/c/gh/rodlukas/UP-admin.svg?style=flat-square"></a>
    <a href="LICENSE"><img alt="GitHub license" src="https://img.shields.io/github/license/rodlukas/UP-admin.svg?style=flat-square"></a>
    <a href="https://github.com/rodlukas/UP-admin/releases/latest"><img alt="GitHub release" src="https://img.shields.io/github/release/rodlukas/UP-admin.svg?style=flat-square"></a>
    <a href="https://github.com/rodlukas/UP-admin/releases/latest"><img alt="GitHub commits since latest release" src="https://img.shields.io/github/commits-since/rodlukas/UP-admin/latest.svg?style=flat-square"></a>
    <br>
    <a href="https://github.com/rodlukas/UP-admin/actions/workflows/codeql.yml"><img alt="GitHub CodeQL" src="https://github.com/rodlukas/UP-admin/actions/workflows/codeql.yml/badge.svg"></a>
    <a href="https://observatory.mozilla.org/analyze/uspesnyprvnacek.herokuapp.com"><img alt="Mozilla HTTP Observatory Grade" src="https://img.shields.io/mozilla-observatory/grade-score/uspesnyprvnacek.herokuapp.com?publish&style=flat-square"></a>
    <a href="https://sonarcloud.io/dashboard?id=rodlukas_UP-admin"><img alt="Sonar Quality Gate" src="https://img.shields.io/sonar/quality_gate/rodlukas_UP-admin?server=https%3A%2F%2Fsonarcloud.io&style=flat-square"></a>
    <br>
    <a href="https://deepscan.io/dashboard#view=project&tid=8194&pid=10346&bid=141965"><img src="https://deepscan.io/api/teams/8194/projects/10346/branches/141965/badge/grade.svg" alt="DeepScan grade"></a>
    <a href="https://codebeat.co/projects/github-com-rodlukas-up-admin-master"><img alt="codebeat badge" src="https://codebeat.co/badges/7ee3ee4d-8e68-4088-8ccd-7a0e57e71a9e" /></a>
    <br>
    <a href="https://stackshare.io/rodlukas/upadmin"><img alt="StackShare" src="http://img.shields.io/badge/tech-stack-0690fa.svg?style=flat-square"></a>
    <a href="https://github.com/prettier/prettier"><img alt="Code style (js): prettier" src="https://img.shields.io/badge/code_style_(js)-prettier-ff69b4.svg?style=flat-square"></a>
    <a href="https://github.com/psf/black"><img alt="Code style (python): black" src="https://img.shields.io/badge/code_style_(python)-black-000000.svg?style=flat-square"></a>
    <br>
    <a href="https://uspesnyprvnacek.herokuapp.com/"><img alt="GitHub deployments" src="https://img.shields.io/github/deployments/rodlukas/UP-admin/uspesnyprvnacek?label=deploy%20%28production%29&style=flat-square"></a>
    <a href="https://up-admin.fly.dev/"><img alt="GitHub deployments" src="https://img.shields.io/github/deployments/rodlukas/UP-admin/uspesnyprvnacek-testing?label=deploy%20%28testing%29&style=flat-square"></a>
    <a href="https://uspesnyprvnacek-demo.herokuapp.com/"><img alt="GitHub deployments" src="https://img.shields.io/github/deployments/rodlukas/UP-admin/uspesnyprvnacek-demo?label=deploy%20%28demo%29&style=flat-square"></a>
</p>

<p align="center">
    <a href="https://sentry.io/organizations/rodlukas/issues/?project=1247206">Sentry</a> ¬∑ 
    <a href="https://dashboard.heroku.com/apps">Heroku</a> ¬∑ 
    <a href="https://uspesnyprvnacek.slack.com/messages">Slack</a> ¬∑ 
    <a href="https://www.deepcode.ai/">DeepCode</a> ¬∑ 
    <a href="https://analytics.google.com/analytics/web/#/report-home/a53235943w186065128p183124243">Google Analytics</a> ¬∑ 
    Logentries ‚Äì 
    <a href="https://addons-sso.heroku.com/apps/20c2c1b9-7573-42c9-ba22-cfdc7568f1f9/addons/551eb689-3908-4088-9100-519dfb42e836">produkce</a> / 
    <a href="https://addons-sso.heroku.com/apps/20090cc9-a6a5-46f4-b6ff-516a1bb9ebf3/addons/398b1cfa-4aa4-499a-a3cd-300f2093c4b3">testing</a> / 
    <a href="https://addons-sso.heroku.com/apps/312b2926-0bff-425b-9902-f71c8b8d223b/addons/43ad6f0f-a3b8-4551-81b5-5aced9b9b143">demo</a>
</p>

## Obsah

-   [Demo](#demo)
-   [Z√°kladn√≠ informace o aplikaci](#z√°kladn√≠-informace-o-aplikaci)
    -   [Kl√≠ƒçov√© funkce](#kl√≠ƒçov√©-funkce)
    -   [Pou≈æit√© technologie](#pou≈æit√©-technologie)
        -   [Backend](#backend)
        -   [Frontend](#frontend)
    -   [Nasazen√© aplikace a n√°stroje](#nasazen√©-aplikace-a-n√°stroje)
-   [Struktura repozit√°≈ôe](#struktura-repozit√°≈ôe)
-   [Spu≈°tƒõn√≠ aplikace](#spu≈°tƒõn√≠-aplikace)
    -   [Po≈æadavky](#po≈æadavky)
    -   [Instalace](#instalace)
    -   [Spu≈°tƒõn√≠](#spu≈°tƒõn√≠)
    -   [Testov√°n√≠](#testov√°n√≠)
-   [Screenshoty](#screenshoty)
-   [Licence](#licence)

## Demo

[**Nasazen√° demo verze aplikace na Heroku**](https://uspesnyprvnacek-demo.herokuapp.com/) ‚Äì √∫daje
pro p≈ôihl√°≈°en√≠: u≈æ. jm√©no `test` / heslo `test`.

> Aplikace po 30 minut√°ch neaktivity us√≠n√° a chv√≠li trv√°, ne≈æ se probud√≠. Datab√°ze v demo verzi je
> ka≈ædou noc (2:00 UTC) **automaticky smaz√°na** a naplnƒõna
> [vzorov√Ωmi daty](scripts/sql/sample_data.pgsql).

## Z√°kladn√≠ informace o aplikaci

Webov√° aplikace pro projekt **[√öspƒõ≈°n√Ω prv≈à√°ƒçek](https://uspesnyprvnacek.cz/)** (mrknƒõte na
[jeho str√°nky](https://uspesnyprvnacek.cz/), tak√© poch√°z√≠ z m√© tvorby) ‚Äì zalo≈æen√° na technologi√≠ch
React (TypeScript), Django (Python), REST API, Django REST Framework.

Aplikaci jsem vytvo≈ôil v roce 2018 jako **bakal√°≈ôskou pr√°ci na [FIT ƒåVUT](https://fit.cvut.cz/cs)**
‚Äì vizte [repozit√°≈ô s textem bakal√°≈ôsk√© pr√°ce](https://github.com/rodlukas/bachelors-thesis). Od t√©
doby je v projektu [√öspƒõ≈°n√Ω prv≈à√°ƒçek](https://uspesnyprvnacek.cz/) dennƒõ √∫spƒõ≈°nƒõ pou≈æ√≠v√°na a jej√≠
roz≈°i≈ôov√°n√≠ a pr√°ce na n√≠ st√°le pokraƒçuj√≠ ‚ù§Ô∏è. V roce 2020 jsem se tak√© v **diplomov√© pr√°ci na FIT
ƒåVUT** vƒõnoval v≈°em dosavadn√≠m roz≈°√≠≈ôen√≠m aplikace o nov√© funkce, technologie a n√°stroje ‚Äì vizte
[repozit√°≈ô s textem diplomov√© pr√°ce](https://github.com/rodlukas/masters-thesis). A v√Ωvoj prob√≠h√° i
nad√°le.

### Kl√≠ƒçov√© funkce

V n√°sleduj√≠c√≠m seznamu jsou nejd≈Øle≈æitƒõj≈°√≠ funkce, kter√° aplikace poskytuje (v√Ωƒçet nen√≠ koneƒçn√Ω):

-   **evidence klient≈Ø a skupin klient≈Ø doch√°zej√≠c√≠ch na lekce kurz≈Ø**,
-   **evidence lekc√≠ klient≈Ø a skupin vƒçetnƒõ p≈ôedplacen√Ωch ‚Äì stav √∫ƒçasti, platba, datum, ƒças,
    zru≈°en√≠, pozn√°mky**,
-   **evidence z√°jemc≈Ø o kurzy**,
-   **zobrazen√≠ lekc√≠ ve 3 form√°ch: v kartƒõ klienta/skupiny, v di√°≈ôi a na hlavn√≠ str√°nce v p≈ôehledu
    pro dne≈°n√≠ den**,
-   kontrola ƒçasov√Ωch konflikt≈Ø lekc√≠,
-   automatick√© ru≈°en√≠ lekc√≠ kdy≈æ nikdo nem√° p≈ôij√≠t,
-   automatick√© vytv√°≈ôen√≠ p≈ôedplacen√Ωch n√°hrad lekc√≠ p≈ôi omluvƒõ p≈ôedem/zru≈°en√≠ ze strany lektorky,
-   upozornƒõn√≠, ≈æe m√° klient p≈ô√≠≈°tƒõ platit,
-   v√Ωpoƒçet po≈ôadov√©ho ƒç√≠sla lekce s ohledem na √∫ƒçast klient≈Ø,
-   vyhled√°v√°n√≠ klient≈Ø (fuzzy vyhled√°v√°n√≠)
-   konfigurace kurz≈Ø a stav≈Ø √∫ƒçasti vƒçetnƒõ nap≈ô. intuitivn√≠ho nastaven√≠ zvolen√© barvy pro kurz,
-   propojen√≠ s API _Fio banky_ ‚Äì na hlavn√≠ str√°nce se p≈ôehlednƒõ zobrazuj√≠ ned√°vn√© transakce z √∫ƒçtu,
-   automatick√Ω odhad kurzu, data a ƒçasu pro novƒõ p≈ôid√°van√© lekce,
-   respektov√°n√≠ a kontrola v≈°ech omezen√≠ dan√Ωch danou dom√©nou (nap≈ô. duplicity),
-   veden√≠ aktivn√≠ch a neaktivn√≠ch klient≈Ø a skupin.

### Pou≈æit√© technologie

Aplikace je rozdƒõlena na **frontend a backend**, ty spolu komunikuj√≠ p≈ôes **REST API** zabezpeƒçen√©
**[JWT](https://jwt.io/) autentizac√≠**. Jako datab√°ze se pou≈æ√≠v√°
[PostgreSQL 12](https://www.postgresql.org/).

> **Pozn√°mka:** souƒç√°st√≠ repozit√°≈ôe je tak√© diagram nasazen√≠ a logick√Ω datov√Ω model ‚Äì viz
> [`docs/README.md`](docs).

#### Backend

Obsahuje ve≈°kerou logiku a pro klienta vystavuje **REST API**, postaven na tƒõchto technologi√≠ch:

-   [Python 3.10](https://www.python.org/),
-   [Django 3](https://www.djangoproject.com/),
-   [Django REST framework 3](https://www.django-rest-framework.org/),
-   [djangorestframework-simplejwt](https://github.com/davesque/django-rest-framework-simplejwt),
-   [a dal≈°√≠...](/Pipfile)

V Djangu jsou pro mnohon√°sobn√© zrychlen√≠ pokroƒçile **optimalizovan√© komplexn√≠ SQL dotazy** (viz
ƒçl√°nky [[1]](https://www.revsys.com/tidbits/django-performance-simple-things/),
[[2]](http://ses4j.github.io/2015/11/23/optimizing-slow-django-rest-framework-performance/)).
Aplikace umo≈æ≈àuje **pokroƒçil√© debugov√°n√≠** na lok√°ln√≠m i vzd√°len√©m prost≈ôed√≠ d√≠ky
**[Django Debug Toolbar](https://github.com/jazzband/django-debug-toolbar)** a jeho dopl≈àku
[Django Debug Toolbar Request History](https://github.com/djsutho/django-debug-toolbar-request-history/).

Pro **statickou typovou kontrolu** se nap≈ô√≠ƒç cel√Ωm k√≥dem pou≈æ√≠vaj√≠ typov√© anotace s pou≈æit√≠m modulu
[typing](https://docs.python.org/3/library/typing.html), pro kontrolu typ≈Ø se pou≈æ√≠v√°
**[mypy](http://mypy-lang.org/)** a [Pycharm](https://www.jetbrains.com/pycharm/). Pro **eliminaci
mrtv√©ho k√≥du** se tak√© pou≈æ√≠v√° **[vulture](https://github.com/jendrikseipp/vulture/)**.

#### Frontend

Responzivn√≠ JS _([TypeScript](https://www.typescriptlang.org/))_ webov√° aplikace typu SPA
([Single-Page-App](https://en.wikipedia.org/wiki/Single-page_application)) postaven√° na tƒõchto
technologi√≠ch:

-   [React 17](https://reactjs.org/),
-   [TypeScript 4](https://www.typescriptlang.org/),
-   [Bootstrap 4](https://getbootstrap.com/) (s [Reactstrap](https://reactstrap.github.io/)em),
-   [React Router 5](https://reacttraining.com/react-router/),
-   [FontAwesome 5 PRO](https://fontawesome.com/) (publikovan√© do priv√°tn√≠ch Github Package
    Registry)
-   [a dal≈°√≠...](/frontend/package.json)

V√Ωvoj frontendu je postaven p≈ôedev≈°√≠m na:

-   [Webpack 5](https://webpack.js.org/) s vlastn√≠ konfigurac√≠ (lok√°ln√≠ i produkƒçn√≠) +
    [Webpack DevServer](https://webpack.js.org/configuration/dev-server/),
-   [Babel 7](https://babeljs.io/),
-   [Typescript 4](https://www.typescriptlang.org/) ‚Äì pro statickou typovou kontrolu,
-   [ESlint 8](https://eslint.org/) a [stylelint](https://stylelint.io/) ‚Äì lintery pro statickou
    anal√Ωzu k√≥du,
-   [husky](https://github.com/typicode/husky) a
    [lint-staged](https://github.com/okonet/lint-staged) ‚Äì pre-commit kontroly (eslint, stylelint)
-   a [React Hot Loader](https://github.com/gaearon/react-hot-loader) ‚Äì pro
    [HMR](https://webpack.js.org/guides/hot-module-replacement/).

Aplikace je **odoln√° proti p√°d≈Øm JS** d√≠ky
**[React Error Boundaries](https://reactjs.org/docs/error-boundaries.html)**. Pro **zrychlen√≠
naƒç√≠t√°n√≠** cel√© aplikace se pou≈æ√≠v√° lazy loading
**[`React.lazy` + `React Suspense`](https://reactjs.org/docs/code-splitting.html)**.
[Webpack DevServer](https://webpack.js.org/configuration/dev-server/) je p≈ôi v√Ωvoji propojen√Ω s
[Django](https://www.djangoproject.com/) dev serverem a umo≈æ≈àuje tak jednoduch√Ω v√Ωvoj bez kompromis≈Ø
vƒçetnƒõ [HMR](https://webpack.js.org/guides/hot-module-replacement/). Glob√°ln√≠ stav aplikace je
spravov√°n p≈ôes **[React Context](https://reactjs.org/docs/context.html)**. ƒå√°st codebase vyu≈æ√≠v√°
tak√© v√Ωhod **[React Hooks](https://reactjs.org/docs/hooks-intro.html)**.

### Nasazen√© aplikace a n√°stroje

Aplikace je nasazena do **4 prost≈ôed√≠ na PaaS [Heroku](https://www.heroku.com/)**, kter√© se li≈°√≠
p≈ô√≠slu≈°nou nasazenou verz√≠ aplikace, konkr√©tn√≠ instanc√≠ datab√°ze a umo≈æ≈àuj√≠ r≈Øzn√© √∫rovnƒõ debugov√°n√≠.
Mimo to lze samoz≈ôejmƒõ aplikaci spustit i v prost≈ôed√≠ lok√°ln√≠m u v√Ωvoj√°≈ôe. Typ prost≈ôed√≠ je tak√©
zv√Ωraznƒõn barevn√Ωm ≈°t√≠tkem v horn√≠m menu (kromƒõ produkce).

> **Seznam prost≈ôed√≠:**
>
> -   **lok√°ln√≠** ‚Äì pro lok√°ln√≠ v√Ωvoj,
> -   **testing** ‚Äì stejn√° konfigurace jako na produkci, deploy p≈ôi ka≈æd√©m commitu; umo≈æ≈àuje zapnout
>     debugov√°n√≠,
> -   **produkce** ‚Äì produkƒçn√≠ verze pou≈æ√≠van√° z√°kazn√≠kem, deploy p≈ôi release,
> -   [**demo**](https://uspesnyprvnacek-demo.herokuapp.com/) ‚Äì demo verze aplikace, manu√°ln√≠ deploy
>     z vƒõtve `demo`.

-   Nasazen√© aplikace jsou **HTTPS-only** (+ pokroƒçil√© zabezpeƒçen√≠, viz
    [[1]](https://docs.djangoproject.com/en/2.0/howto/deployment/checklist/),
    [[2]](https://wsvincent.com/django-best-practices/)).
-   Na produkci se ka≈æd√Ω den ve 3:00 prov√°d√≠
    [automatick√° z√°loha datab√°ze](https://devcenter.heroku.com/articles/heroku-postgres-backups#scheduling-backups).
-   Pro **automatick√© form√°tov√°n√≠ k√≥d≈Ø** se pou≈æ√≠v√° **[Black](https://github.com/psf/black)**
    (Python) a **[Prettier](https://prettier.io/)** (TS, TSX, JS, CSS, HTML, JSON, YAML, TOML, MD),
    oba n√°stroje jsou napojen√© na IDE a prov√°dƒõj√≠ automatick√© √∫pravy.
-   **Aplikace jsou napojen√© na dal≈°√≠ slu≈æby:**
    -   **CI a CD** m√° na starost [GitHub Actions](https://github.com/features/actions) ‚Äì
        automatizovan√Ω build, testov√°n√≠ i nasazen√≠ na r≈Øzn√° prost≈ôed√≠, automaticky prov√°dƒõn√©
        pokroƒçilej≈°√≠ skripty nap≈ô. pro automatick√© zaps√°n√≠ verze do aplikace, pr√°ci s tokeny,
        nahr√°n√≠ sestaven√©ho frontendu do asset≈Ø k releasu na GitHubu, napojen√≠ na slu≈æby pro v√Ωpoƒçet
        pokryt√≠ k√≥du a dal≈°√≠.
    -   **Automatickou pr≈Øbƒõ≈ænou anal√Ωzu a kontrolu k√≥du** vƒçetnƒõ hodnocen√≠ kvality k√≥du, hled√°n√≠
        potenci√°ln√≠ch chyb a zranitelnost√≠ m√° na starost
        [GitHub CodeQL](https://codeql.github.com/), [SonarCloud](https://sonarcloud.io/) a
        [DeepScan](https://deepscan.io/).
    -   **Logov√°n√≠** z Heroku se zas√≠l√° do [Logentries](https://logentries.com/) (logy se uchov√°vaj√≠
        po 7 dn≈Ø, t≈ô√≠dƒõn√© podle typu prost≈ôed√≠).
    -   **Odchyt√°v√°n√≠ chyb na backendu i frontendu** vƒçetnƒõ n√°sledn√© evidence, notifikac√≠ a
        propojen√≠ s repozit√°≈ôem za≈ôizuje [Sentry](https://sentry.io/) (t≈ô√≠dƒõn√© podle typu prost≈ôed√≠,
        aktivn√≠ na v≈°ech nasazen√Ωch aplikac√≠ch). P≈ôi chybƒõ na frontendu je mo≈æn√© poslat **zpƒõtnou
        vazbu v√°zanou ke konkr√©tn√≠ chybƒõ** d√≠ky propojen√≠ Sentry a
        [React Error Boundaries](https://reactjs.org/docs/error-boundaries.html).
    -   **Sledov√°n√≠ toku u≈æivatel≈Ø** umo≈æ≈àuje napojen√≠ na
        [Google Analytics](https://analytics.google.com/) (p≈ôes modul
        [react-ga](https://github.com/react-ga/react-ga)).
    -   [Slack](https://slack.com/)
-   [audit-ci](https://github.com/IBM/audit-ci) se pou≈æ√≠v√° pro automatizovanou kontrolu zraniteln√Ωch
    z√°vislost√≠ projektu na CI.
-   Aplikace **respektuje standardy** [PEP 8](https://pep8.org),
    [12-Factor App](https://12factor.net/), [ROCA](https://roca-style.org/).
-   Kompletn√≠ v√Ωvoj aplikace prob√≠h√° v IDE
    _[Pycharm (Professional Edition)](https://www.jetbrains.com/pycharm/)_ (≈ôe≈°√≠ automatickou
    optimalizaci import≈Ø, automatick√© form√°tov√°n√≠ k√≥d≈Ø apod.).
-   **Rozs√°hl√© testy API i UI (E2E)** jsou d≈Øle≈æitou ƒç√°st√≠ aplikace, automaticky se spou≈°t√≠ na CI a
    lze je spustit i na lok√°ln√≠m prost≈ôed√≠. ƒå√°st frontendu je nav√≠c pokryta **unit testy**.
    -   E2E testov√°n√≠ je postaveno na **BDD frameworku [behave](https://github.com/behave/behave)**
        ‚Äì testov√© sc√©n√°≈ôe jsou ps√°ny p≈ôirozen√Ωm jazykem (Gherkin), podle nich se spou≈°t√≠ konkr√©tn√≠
        testy.
    -   Unit testy jsou postaveny na **frameworku [Jest](https://jestjs.io/)** a n√°stroj√≠ch
        **[React Testing Library](https://testing-library.com/docs/react-testing-library/intro)**
        (jednoduch√© utility pro testov√°n√≠ Reactu),
        [jest-dom](https://testing-library.com/docs/ecosystem-jest-dom) (custom DOM element matchers
        pro Jest) a [MSW](https://mswjs.io/) (mockov√°n√≠ API).
    -   Pro **testov√°n√≠ UI (E2E)** se pou≈æ√≠v√° [Selenium](https://github.com/SeleniumHQ/selenium).
    -   **Podrobn√© informace o testech jsou v [`tests/README.md`](tests)**.

## Struktura repozit√°≈ôe

```
‚îú‚îÄ‚îÄ .idea ........ nastaven√≠ pro IDE (Pycharm od Jetbrains)
‚îú‚îÄ‚îÄ admin ........ Django aplikace pro webovou aplikaci
‚îú‚îÄ‚îÄ api .......... Django aplikace pro REST API
‚îú‚îÄ‚îÄ docs ......... dal≈°√≠ dokumentace a soubory k aplikaci vƒçetnƒõ diagram≈Ø
‚îú‚îÄ‚îÄ frontend ..... klientsk√° ƒç√°st webov√© aplikace
‚îú‚îÄ‚îÄ scripts ...... skripty pro CI/CD/PaaS/instalaci
‚îú‚îÄ‚îÄ staticfiles .. slo≈æka pro statick√© soubory (pr√°zdn√°, p≈ôesun a≈æ na CI)
‚îú‚îÄ‚îÄ tests ........ testy API i UI (e2e)
‚îî‚îÄ‚îÄ up ........... cel√Ω Django projekt
```

## Spu≈°tƒõn√≠ aplikace

Aplikaci lze spustit na lok√°ln√≠m prost≈ôed√≠ ve dvou re≈æimech. V√Ωchoz√≠ re6im je klasick√Ω v√Ωvojov√Ω ‚Äì
ten obsahuje pokroƒçil√© debugovac√≠ n√°stroje, spou≈°t√≠ se Django v√Ωvojov√Ω server a tak√©
webpack-dev-server pro frontend. Vzhledem k pr√°ci s priv√°tn√≠mi GitHub Package registry (viz
[n√≠≈æe](#npmpro)) nelze samoz≈ôejmƒõ bez p≈ô√≠slu≈°n√Ωch token≈Ø sestavovat frontend, proto zde budu
popisovat postup spu≈°tƒõn√≠ ve druh√©m re≈æimu ‚Äì **manu√°ln√≠ produkƒçn√≠ verze aplikace**, tedy ta, kter√°
je nejbl√≠≈æe verzi u z√°kazn√≠ka.

### Po≈æadavky

Minim√°ln√≠ po≈æadavky na n√°stroje nainstalovan√© v c√≠lov√©m OS:

-   [Python 3](https://www.python.org/downloads/) (konkr√©tn√≠ verze viz [`Pipfile`](/Pipfile)),
-   [Pipenv](https://pipenv.pypa.io/en/latest/#install-pipenv-today),
-   [Git](https://git-scm.com/downloads),
-   [PostgreSQL 12](https://www.postgresql.org/download/).

<a name="npmpro">
  
> **Pozn√°mka:** Node.js ani npm nejsou po≈æadov√°ny, proto≈æe ve vlastn√≠m prost≈ôed√≠ nelze frontend sestavit (je pot≈ôeba
 p≈ô√≠stup p≈ôes token k priv√°tn√≠mu GitHub Package registru pro [FontAwesome PRO](https://fontawesome.com/)). M√≠sto toho zde pou≈æijeme 
 automaticky sestavenou posledn√≠ produkƒçn√≠ verzi frontendu z integraƒçn√≠ho serveru (kter√° se automaticky nahr√°v√° do asset≈Ø ke ka≈æd√©mu release).
 
</a>

### Instalace

Pokud u≈æ po≈æadavky v√Ω≈°e spl≈àujete, m≈Ø≈æeme se vrhnout na instalaci:

1.  Nejd≈ô√≠ve **naklonujeme repozit√°≈ô**, otev≈ôeme jeho slo≈æku a nahrajeme si **posledn√≠ produkƒçn√≠
    verzi** repozit√°≈ôe:

    ```bash
    git clone "https://github.com/rodlukas/UP-admin.git" && cd UP-admin
    git checkout $(git describe --tags `git rev-list --tags --max-count=1`)
    ```

2.  St√°hneme ji≈æ **sestaven√© zdrojov√© k√≥dy frontendu** z posledn√≠ produkƒçn√≠ verze a **rozbal√≠me** je
    p≈ô√≠mo do repozit√°≈ôe (a `frontend.zip` sma≈æeme):

    ```bash
    wget https://github.com/rodlukas/UP-admin/releases/latest/download/frontend.zip
    unzip frontend.zip && rm frontend.zip
    ```

3.  **P≈ôejmenujeme vzorov√Ω konfiguraƒçn√≠ soubor `.env.template`** v ko≈ôenov√©m adres√°≈ôi na **`.env`**:

    ```bash
    mv .env.template .env
    ```

4.  Pomoc√≠ **[_psql CLI_](https://www.postgresql.org/docs/current/app-psql.html)** **vytvo≈ô√≠me
    datab√°zi a u≈æivatele** pro p≈ô√≠stup do datab√°ze:

    ```bash
    sudo -u postgres psql -c "CREATE USER up WITH ENCRYPTED PASSWORD 'up';" -c "CREATE DATABASE up WITH OWNER up;"
    ```

5.  Nahrajeme **ƒçesk√Ω bal√≠ƒçek pro datab√°zi** (kv≈Øli ƒçesk√©mu ≈ôazen√≠ podle abecedy):

    ```bash
    source scripts/shell/postgresql_cs.sh
    ```

6.  Nainstalujeme v≈°echny **z√°vislosti pro backend** a aktivujeme virtu√°ln√≠ prost≈ôed√≠ Pythonu:

    ```bash
    pipenv install --dev
    pipenv shell
    ```

7.  **P≈ôiprav√≠me celou Django aplikaci na spu≈°tƒõn√≠** ([skript](scripts/shell/release_tasks.sh)
    nastav√≠ v√Ωchoz√≠ soubor s nastaven√≠m Djanga, p≈ôiprav√≠ statick√© soubory frontendu a vytvo≈ô√≠
    datab√°zov√© sch√©ma):

    ```bash
    source scripts/shell/release_tasks.sh
    ```

8.  A vytvo≈ô√≠me **u≈æivatelsk√Ω √∫ƒçet pro p≈ô√≠stup do aplikace** (zad√°me libovoln√© √∫daje, kter√Ωmi se
    pot√© budeme p≈ôihla≈°ovat):

    ```bash
    python manage.py createsuperuser
    ```

9.  üí° _(NEPOVINN√â)_ Na z√°vƒõr m≈Ø≈æeme je≈°tƒõ **naplnit na≈°√≠ datab√°zi
    [p≈ôedp≈ôipraven√Ωmi vzorov√Ωmi daty](scripts/sql/sample_data.pgsql)**, kter√° uk√°≈æou fungov√°n√≠
    aplikace a usnadn√≠ prvn√≠ pou≈æit√≠ (obsahuj√≠ nƒõkolik klient≈Ø, skupin, lekc√≠, z√°jemc≈Ø, kurz≈Ø a
    stav≈Ø √∫ƒçasti) ‚Äì po zad√°n√≠ p≈ô√≠kazu je vy≈æadov√°no heslo datab√°zov√©ho u≈æivatele `up`, kter√© jsme
    nastavili takt√©≈æ `up`:

    ```bash
    psql --dbname up -h localhost -U up -f scripts/sql/sample_data.pgsql
    ```

### Spu≈°tƒõn√≠

**Spust√≠me v√Ωvojov√Ω server** üöÄ:

```bash
python manage.py runserver 0.0.0.0:8000
```

**‚úÖ Aplikace je nyn√≠ dostupn√° na adrese <http://localhost:8000/>.**

> **Pozn√°mka: otev≈ôen√≠ aplikace na jin√©m za≈ô√≠zen√≠ v s√≠ti** ‚Äì aplikace je p≈ôipravena pro pou≈æit√≠ i z
> dal≈°√≠ch za≈ô√≠zen√≠ch v s√≠ti (nap≈ô. z mobiln√≠ho telefonu), obvykle je pot≈ôeba prov√©st tyto 2 kroky:
>
> 1.  povolit Python a Node.js ve firewallu (nap≈ô. na chv√≠li aktivovat interaktivn√≠ re≈æim ESETu),
> 2.  na mobiln√≠m za≈ô√≠zen√≠ zadat hostname nebo priv√°tn√≠ IP adresu poƒç√≠taƒçe, na kter√©m bƒõ≈æ√≠ server.

### Testov√°n√≠

M≈Ø≈æeme tak√© snadno spustit r≈Øzn√© testy aplikace, nap≈ô√≠klad otestovat, jestli spr√°vnƒõ funguje API pro
klienty:

```bash
python manage.py behave --stage=api --tags=clients
```

Aplikace obsahuje **rozs√°hl√© API a UI (e2e) testy** ‚Äì vizte
[podrobn√© informace o testech a mo≈ænostech spou≈°tƒõn√≠](tests).

## Screenshoty

> **Pozn√°mka:** √∫daje v aplikaci jsou smy≈°len√©.

### Di√°≈ô

[![screenshot z di√°≈ôe](docs/screenshots/diary.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/diary.png)

### P≈ôehled (hlavn√≠ str√°nka)

[![screenshot z p≈ôehledu](docs/screenshots/dashboard.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/dashboard.png)

### Karta klienta / skupiny

[![screenshot z karty klienta](docs/screenshots/card-client.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/card-client.png)

[![screenshot z karty skupiny](docs/screenshots/card-group.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/card-group.png)

### Z√°jemci o kurzy

[![screenshot ze z√°jemc≈Ø o kurzy](docs/screenshots/applications.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/applications.png)

### Nastaven√≠

[![screenshot z nastaven√≠](docs/screenshots/settings.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/settings.png)

### Formul√°≈ôe

#### √öprava skupinov√© lekce

[![screenshot formul√°≈ôe pro √∫pravu skupinov√© lekce](docs/screenshots/form-lecture.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/form-lecture.png)

#### √öprava √∫daj≈Ø o skupinƒõ

[![screenshot formul√°≈ôe pro √∫pravu √∫daj≈Ø o skupinƒõ](docs/screenshots/form-group.png)](https://raw.githubusercontent.com/rodlukas/UP-admin/master/docs/screenshots/form-group.png)

## Historie

-   Projekt p≈Øvodnƒõ pro CI & CD pou≈æ√≠val [Travis](https://travis-ci.com/), ale v listopadu 2022
    do≈°lo k migraci na GitHub Actions.
-   Automatickou pr≈Øbƒõ≈ænou anal√Ωzu a kontrolu k√≥du zaji≈°≈•oval mj. [LGTM](https://lgtm.com/) a≈æ do
    listopadu 2022, kdy byl nahrazen sv√Ωm n√°stupcem [GitHub CodeQL](https://codeql.github.com/).

## Licence

Licencov√°no pod [MIT](LICENSE) licenc√≠.

Copyright (c) 2018‚Äì2022 [Luk√°≈° Rod](https://lukasrod.cz/)
